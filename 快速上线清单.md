# ⚡ Citea SaaS 快速上线清单

## 🎯 目标：让真实用户可以使用你的 SaaS 产品

---

## ✅ 必需步骤（15 分钟）

### 1. 配置 Resend 自定义域名（最重要！）

**为什么要做？**
- ❌ 测试域名只能发送给验证过的邮箱（不适合 SaaS）
- ✅ 自定义域名可以发送给任何用户

**操作步骤**:

#### 步骤 A: 在 Resend 添加域名
1. 访问: https://resend.com/domains
2. 登录你的 Resend 账号
3. 点击 "Add Domain"
4. 输入你的域名（例如：`citea.com`）
5. 点击 "Add"

#### 步骤 B: 配置 DNS（在你的域名注册商）
复制 Resend 提供的 DNS 记录，添加到你的域名 DNS：

**必需记录**:
1. TXT: `_resend` → 验证记录
2. TXT: `@` → SPF 记录
3. MX: `@` → 邮件记录
4. TXT: `resend._domainkey` → DKIM 记录

**等待**: DNS 生效需要 10-60 分钟

#### 步骤 C: 在 Resend 查看验证状态
- 回到 Resend Dashboard
- 等待显示 "Verified" 绿色标记
- ✅ 验证完成！

### 2. 更新环境变量

#### 在 Vercel Dashboard 添加：

```bash
# 邮件发件人（必需！替换为你的域名邮箱）
RESEND_FROM_EMAIL=Citea <noreply@yourdomain.com>

# 其他变量（应该已经设置了）
REDIS_URL=redis://...
JWT_SECRET=...
RESEND_API_KEY=...
NODE_ENV=production
```

**⚠️ 重要**: 替换 `yourdomain.com` 为你的实际域名！

### 3. 更新代码

代码已自动支持 `RESEND_FROM_EMAIL` 环境变量，无需修改代码。

### 4. 部署

```bash
git push
```

Vercel 会自动部署。

---

## ✅ 测试清单

### 1. 邮件测试
```bash
node scripts/test-email.js your-test-email@gmail.com
```

应该能收到测试邮件。

### 2. 注册流程测试

1. 访问你的网站
2. 注册新用户（使用真实邮箱）
3. ✅ 应该收到验证码邮件
4. 输入验证码验证
5. ✅ 应该成功登录

### 3. 功能验证

- [ ] 注册新用户
- [ ] 收到验证邮件
- [ ] 验证码验证成功
- [ ] 登录功能正常
- [ ] 数据保存到 Redis
- [ ] 会话保持正常

---

## 🚨 如果没有域名怎么办？

### 选项 1: 使用免费域名

- **Freenom**: https://www.freenom.com/ (免费 .tk, .ml 等)
- **Namecheap**: 约 $1/年 (促销时)

### 选项 2: 临时使用测试邮箱

**限制**: 每个邮箱都需要在 Resend 手动添加

1. 访问: https://resend.com/settings
2. 添加常用测试邮箱到 "Test Mode Emails"
3. 这些邮箱可以接收邮件

**⚠️ 注意**: 这不是 SaaS 产品的长期解决方案！

---

## 📋 完整配置清单

### Vercel 环境变量（全部必需）

```bash
# 数据库
REDIS_URL=redis://default:xxx@redis-xxx.xxx.com:19318

# 认证
JWT_SECRET=your-32-char-secret-key

# 邮件服务
RESEND_API_KEY=re_xxxxx...
RESEND_FROM_EMAIL=Citea <noreply@yourdomain.com>

# 环境
NODE_ENV=production
NEXT_PUBLIC_APP_URL=https://yourdomain.com
```

### DNS 配置（在域名注册商）

```
TXT _resend → Resend 验证记录
TXT @ → v=spf1 include:_spf.resend.com ~all
MX @ → feedback-smtp.resend.com (优先级 10)
TXT resend._domainkey → Resend DKIM 记录
```

---

## ⏱️ 时间估算

- DNS 配置: 5 分钟
- DNS 生效等待: 10-60 分钟
- Vercel 配置: 5 分钟
- 测试: 5 分钟

**总计**: 约 25-75 分钟

---

## 🎯 优先级

### 高优先级（必须完成）
1. ✅ 配置 Resend 自定义域名
2. ✅ 设置 RESEND_FROM_EMAIL 环境变量
3. ✅ 测试邮件发送

### 中优先级（推荐完成）
4. ⬜ 配置自定义网站域名
5. ⬜ 添加错误监控（Sentry）
6. ⬜ 优化用户提示信息

### 低优先级（可选）
7. ⬜ 添加 Rate Limiting
8. ⬜ 配置备份策略
9. ⬜ 性能优化

---

## 🆘 遇到问题？

### 问题 1: DNS 验证失败

**检查**:
- DNS 记录是否正确
- TTL 是否已更新
- 使用 `nslookup` 或 `dig` 检查 DNS

**解决**:
- 等待更长时间（最长 24 小时）
- 检查 DNS 记录拼写
- 联系 Resend 支持

### 问题 2: 收不到邮件

**检查清单**:
1. Resend 域名是否已验证 ✅
2. RESEND_FROM_EMAIL 是否正确 ✅
3. 检查垃圾邮件文件夹 📧
4. Resend Dashboard 查看发送状态 📊

### 问题 3: 部署失败

**检查**:
- 所有环境变量是否设置
- Git 推送是否成功
- Vercel 日志查看错误

---

## ✅ 完成标志

当以下条件满足时，你的 SaaS 就准备好了：

- ✅ Resend 域名已验证
- ✅ Vercel 环境变量已配置
- ✅ 测试注册流程成功
- ✅ 真实邮箱能收到验证码
- ✅ 用户可以成功注册和登录

---

## 🚀 现在开始！

**立即行动**:
1. 打开 https://resend.com/domains
2. 添加你的域名
3. 配置 DNS 记录
4. 等待验证完成
5. 在 Vercel 设置环境变量
6. 测试！

**完成后，真实用户就可以使用你的 SaaS 产品了！** 🎉

---

需要详细步骤？查看: `SaaS生产环境配置指南.md`

