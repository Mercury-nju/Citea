# ğŸ“§ å…è´¹é‚®ä»¶æœåŠ¡æ›¿ä»£æ–¹æ¡ˆ

## å½“å‰æƒ…å†µ
- âœ… Resend å…è´¹é¢åº¦å·²ç”¨å®Œ
- âš ï¸ åªèƒ½ç»‘å®šä¸€ä¸ªåŸŸå
- ğŸ’° æš‚æ—¶æ— æ³•å‡çº§ä»˜è´¹

---

## ğŸ†“ å…è´¹é‚®ä»¶æœåŠ¡æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: Brevo (æ¨èï¼)

**å…è´¹é¢åº¦**: æ¯å¤© 300 å°é‚®ä»¶ï¼ˆæ°¸ä¹…å…è´¹ï¼‰

#### ä¼˜åŠ¿
- âœ… å®Œå…¨å…è´¹ï¼Œæ— éœ€ä¿¡ç”¨å¡
- âœ… æ¯å¤© 300 å°è¶³å¤ŸåˆæœŸä½¿ç”¨
- âœ… æ”¯æŒè‡ªå®šä¹‰åŸŸå
- âœ… æä¾› REST API å’Œ SMTP
- âœ… æœ‰ä¸­æ–‡ç•Œé¢

#### é›†æˆæ­¥éª¤

**1. æ³¨å†Œ Brevo**:
- è®¿é—®: https://www.brevo.com/
- ç‚¹å‡» "å…è´¹æ³¨å†Œ"
- å¡«å†™ä¿¡æ¯æ³¨å†Œï¼ˆæ— éœ€ä¿¡ç”¨å¡ï¼‰

**2. è·å– API Key**:
- ç™»å½•åè¿›å…¥ "SMTP & API"
- ç‚¹å‡» "Create a new API key"
- å¤åˆ¶ API Key

**3. å®‰è£…åŒ…**:
```bash
npm install @getbrevo/brevo
```

**4. åˆ›å»º Brevo é‚®ä»¶æœåŠ¡**:
åˆ›å»º `lib/email-brevo.ts`:
```typescript
import * as brevo from '@getbrevo/brevo'

const apiInstance = new brevo.TransactionalEmailsApi()
apiInstance.setApiKey(
  brevo.TransactionalEmailsApiApiKeys.apiKey,
  process.env.BREVO_API_KEY || ''
)

export async function sendVerificationEmail(email: string, code: string, name: string) {
  if (!process.env.BREVO_API_KEY) {
    console.warn('BREVO_API_KEY not configured')
    return { success: false, error: 'Email service not configured' }
  }

  try {
    const sendSmtpEmail = new brevo.SendSmtpEmail()
    sendSmtpEmail.to = [{ email, name }]
    sendSmtpEmail.sender = { 
      email: 'noreply@yourdomain.com', 
      name: 'Citea' 
    }
    sendSmtpEmail.subject = 'éªŒè¯æ‚¨çš„ Citea è´¦å·'
    sendSmtpEmail.htmlContent = `
      <!DOCTYPE html>
      <html>
        <head>
          <meta charset="utf-8">
          <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }
            .header h1 { color: white; margin: 0; }
            .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }
            .code-box { background: white; border: 2px solid #667eea; border-radius: 8px; padding: 20px; text-align: center; margin: 20px 0; }
            .code { font-size: 32px; font-weight: bold; letter-spacing: 5px; color: #667eea; }
          </style>
        </head>
        <body>
          <div class="container">
            <div class="header">
              <h1>ğŸ“ Citea</h1>
            </div>
            <div class="content">
              <h2>æ‚¨å¥½, ${name}!</h2>
              <p>æ„Ÿè°¢æ‚¨æ³¨å†Œ Citea è´¦å·ã€‚è¯·ä½¿ç”¨ä»¥ä¸‹éªŒè¯ç å®Œæˆæ³¨å†Œ:</p>
              
              <div class="code-box">
                <div class="code">${code}</div>
              </div>
              
              <p>æ­¤éªŒè¯ç å°†åœ¨ <strong>10 åˆ†é’Ÿ</strong>åè¿‡æœŸã€‚</p>
              <p>å¦‚æœæ‚¨æ²¡æœ‰æ³¨å†Œ Citea è´¦å·ï¼Œè¯·å¿½ç•¥æ­¤é‚®ä»¶ã€‚</p>
            </div>
          </div>
        </body>
      </html>
    `

    const result = await apiInstance.sendTransacEmail(sendSmtpEmail)
    return { success: true, data: result }
  } catch (error) {
    console.error('Brevo é‚®ä»¶å‘é€å¤±è´¥:', error)
    return { success: false, error }
  }
}

export async function sendWelcomeEmail(email: string, name: string) {
  if (!process.env.BREVO_API_KEY) {
    return { success: false, error: 'Email service not configured' }
  }

  try {
    const sendSmtpEmail = new brevo.SendSmtpEmail()
    sendSmtpEmail.to = [{ email, name }]
    sendSmtpEmail.sender = { 
      email: 'noreply@yourdomain.com', 
      name: 'Citea' 
    }
    sendSmtpEmail.subject = 'æ¬¢è¿åŠ å…¥ Citea!'
    sendSmtpEmail.htmlContent = `
      <!DOCTYPE html>
      <html>
        <head><meta charset="utf-8"></head>
        <body style="font-family: Arial, sans-serif; padding: 20px;">
          <h1 style="color: #667eea;">ğŸ‰ æ¬¢è¿åŠ å…¥ Citea!</h1>
          <p>ä½ å¥½, ${name}!</p>
          <p>æ­å–œæ‚¨æˆåŠŸæ³¨å†Œ Citea è´¦å·ï¼</p>
          <h3>âœ¨ æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨:</h3>
          <ul>
            <li>ğŸ“š AI æ–‡çŒ®æŸ¥æ‰¾</li>
            <li>âœ“ å¼•ç”¨éªŒè¯</li>
            <li>ğŸ’¬ AI åŠ©æ‰‹</li>
          </ul>
          <p>ç¥æ‚¨ç ”ç©¶é¡ºåˆ©ï¼</p>
        </body>
      </html>
    `

    const result = await apiInstance.sendTransacEmail(sendSmtpEmail)
    return { success: true, data: result }
  } catch (error) {
    console.error('Brevo æ¬¢è¿é‚®ä»¶å¤±è´¥:', error)
    return { success: false, error }
  }
}
```

**5. ç¯å¢ƒå˜é‡**:
```bash
BREVO_API_KEY=your_brevo_api_key_here
```

---

### æ–¹æ¡ˆ 2: Mailjet

**å…è´¹é¢åº¦**: æ¯å¤© 200 å°ï¼Œæ¯æœˆ 6,000 å°

#### ä¼˜åŠ¿
- âœ… å®Œå…¨å…è´¹
- âœ… æ”¯æŒè‡ªå®šä¹‰åŸŸå
- âœ… REST API å’Œ SMTP
- âœ… å®æ—¶ç»Ÿè®¡

#### å¿«é€Ÿé›†æˆ
```bash
npm install node-mailjet
```

ç¯å¢ƒå˜é‡:
```bash
MAILJET_API_KEY=your_api_key
MAILJET_SECRET_KEY=your_secret_key
```

---

### æ–¹æ¡ˆ 3: SendGrid (æœ‰é™å…è´¹)

**å…è´¹é¢åº¦**: æ¯å¤© 100 å°

#### æ³¨æ„
- éœ€è¦ä¿¡ç”¨å¡éªŒè¯
- é€‚åˆå°è§„æ¨¡æµ‹è¯•

---

### æ–¹æ¡ˆ 4: Gmail SMTPï¼ˆæœ€ç®€å•ï¼æ¨èæµ‹è¯•ç”¨ï¼‰

**å…è´¹é¢åº¦**: æ¯å¤© 500 å°

#### ä¼˜åŠ¿
- âœ… å®Œå…¨å…è´¹
- âœ… æ— éœ€ä¿¡ç”¨å¡
- âœ… 5 åˆ†é’Ÿé›†æˆ
- âœ… ç¨³å®šå¯é 

#### é›†æˆæ­¥éª¤

**1. ç”Ÿæˆ Gmail åº”ç”¨ä¸“ç”¨å¯†ç **:
1. ç™»å½• Gmail
2. è®¿é—®: https://myaccount.google.com/apppasswords
3. é€‰æ‹© "é‚®ä»¶" å’Œ "å…¶ä»–è®¾å¤‡"
4. ç”Ÿæˆå¯†ç ï¼ˆ16 ä½ï¼‰

**2. å®‰è£… Nodemailer**:
```bash
npm install nodemailer
```

**3. åˆ›å»º Gmail é‚®ä»¶æœåŠ¡**:
åˆ›å»º `lib/email-gmail.ts`:
```typescript
import nodemailer from 'nodemailer'

const transporter = nodemailer.createTransport({
  service: 'gmail',
  auth: {
    user: process.env.GMAIL_USER, // ä½ çš„ Gmail åœ°å€
    pass: process.env.GMAIL_APP_PASSWORD, // åº”ç”¨ä¸“ç”¨å¯†ç 
  },
})

export async function sendVerificationEmail(email: string, code: string, name: string) {
  if (!process.env.GMAIL_USER || !process.env.GMAIL_APP_PASSWORD) {
    return { success: false, error: 'Gmail not configured' }
  }

  try {
    const info = await transporter.sendMail({
      from: `"Citea" <${process.env.GMAIL_USER}>`,
      to: email,
      subject: 'éªŒè¯æ‚¨çš„ Citea è´¦å·',
      html: `
        <!DOCTYPE html>
        <html>
          <head><meta charset="utf-8"></head>
          <body style="font-family: Arial, sans-serif; padding: 20px;">
            <h1 style="color: #667eea;">ğŸ“ Citea</h1>
            <h2>æ‚¨å¥½, ${name}!</h2>
            <p>æ„Ÿè°¢æ‚¨æ³¨å†Œ Citea è´¦å·ã€‚è¯·ä½¿ç”¨ä»¥ä¸‹éªŒè¯ç å®Œæˆæ³¨å†Œ:</p>
            <div style="background: white; border: 2px solid #667eea; border-radius: 8px; padding: 20px; text-align: center; margin: 20px 0;">
              <div style="font-size: 32px; font-weight: bold; letter-spacing: 5px; color: #667eea;">${code}</div>
            </div>
            <p>æ­¤éªŒè¯ç å°†åœ¨ <strong>10 åˆ†é’Ÿ</strong>åè¿‡æœŸã€‚</p>
          </body>
        </html>
      `,
    })

    return { success: true, data: info }
  } catch (error) {
    console.error('Gmail å‘é€å¤±è´¥:', error)
    return { success: false, error }
  }
}

export async function sendWelcomeEmail(email: string, name: string) {
  if (!process.env.GMAIL_USER || !process.env.GMAIL_APP_PASSWORD) {
    return { success: false, error: 'Gmail not configured' }
  }

  try {
    const info = await transporter.sendMail({
      from: `"Citea" <${process.env.GMAIL_USER}>`,
      to: email,
      subject: 'æ¬¢è¿åŠ å…¥ Citea!',
      html: `
        <h1 style="color: #667eea;">ğŸ‰ æ¬¢è¿åŠ å…¥ Citea!</h1>
        <p>ä½ å¥½, ${name}!</p>
        <p>æ­å–œæ‚¨æˆåŠŸæ³¨å†Œ Citea è´¦å·ï¼</p>
        <h3>âœ¨ æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨:</h3>
        <ul>
          <li>ğŸ“š AI æ–‡çŒ®æŸ¥æ‰¾</li>
          <li>âœ“ å¼•ç”¨éªŒè¯</li>
          <li>ğŸ’¬ AI åŠ©æ‰‹</li>
        </ul>
      `,
    })

    return { success: true, data: info }
  } catch (error) {
    console.error('Gmail æ¬¢è¿é‚®ä»¶å¤±è´¥:', error)
    return { success: false, error }
  }
}
```

**4. ç¯å¢ƒå˜é‡**:
```bash
GMAIL_USER=your-gmail@gmail.com
GMAIL_APP_PASSWORD=your-16-digit-app-password
```

---

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | å…è´¹é¢åº¦ | é…ç½®éš¾åº¦ | éœ€è¦ä¿¡ç”¨å¡ | è‡ªå®šä¹‰åŸŸå | æ¨èåº¦ |
|------|---------|---------|-----------|-----------|--------|
| **Brevo** | 300/å¤© | â­â­ | âŒ | âœ… | â­â­â­â­â­ |
| **Gmail SMTP** | 500/å¤© | â­ | âŒ | âŒ | â­â­â­â­ |
| **Mailjet** | 200/å¤© | â­â­ | âŒ | âœ… | â­â­â­â­ |
| **SendGrid** | 100/å¤© | â­â­â­ | âœ… | âœ… | â­â­â­ |

---

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### ç«‹å³å¯ç”¨ï¼ˆ5 åˆ†é’Ÿï¼‰: Gmail SMTP
- æœ€ç®€å•ï¼Œ5 åˆ†é’Ÿé›†æˆ
- å®Œå…¨å…è´¹ï¼Œæ¯å¤© 500 å°
- é€‚åˆåˆæœŸæµ‹è¯•å’Œå°è§„æ¨¡ç”¨æˆ·

### é•¿æœŸæ–¹æ¡ˆï¼ˆ15 åˆ†é’Ÿï¼‰: Brevo
- æ¯å¤© 300 å°ï¼Œæ°¸ä¹…å…è´¹
- æ”¯æŒè‡ªå®šä¹‰åŸŸå
- æ›´ä¸“ä¸šçš„é‚®ä»¶æœåŠ¡

---

## ğŸš€ ç«‹å³è¡ŒåŠ¨

### æ–¹æ¡ˆ A: ä½¿ç”¨ Gmailï¼ˆæœ€å¿«ï¼‰

1. **ç”Ÿæˆåº”ç”¨å¯†ç **:
   https://myaccount.google.com/apppasswords

2. **å®‰è£…åŒ…**:
   ```bash
   npm install nodemailer
   ```

3. **æˆ‘å¸®ä½ åˆ›å»ºæ–‡ä»¶**ï¼ˆå‘Šè¯‰æˆ‘ä½ é€‰è¿™ä¸ªæ–¹æ¡ˆï¼‰

### æ–¹æ¡ˆ B: ä½¿ç”¨ Brevoï¼ˆæ¨èï¼‰

1. **æ³¨å†Œ Brevo**:
   https://www.brevo.com/

2. **è·å– API Key**

3. **æˆ‘å¸®ä½ é›†æˆ**ï¼ˆå‘Šè¯‰æˆ‘ä½ é€‰è¿™ä¸ªæ–¹æ¡ˆï¼‰

---

## ğŸ’¡ æš‚æ—¶ç»•è¿‡é‚®ä»¶éªŒè¯ï¼ˆå¼€å‘æµ‹è¯•ç”¨ï¼‰

å¦‚æœä½ æƒ³å…ˆä¸Šçº¿åŸºæœ¬åŠŸèƒ½ï¼Œå¯ä»¥æš‚æ—¶ç¦ç”¨é‚®ä»¶éªŒè¯ï¼š

ä¿®æ”¹ `app/api/auth/signup/route.ts`:
```typescript
// æš‚æ—¶è·³è¿‡é‚®ä»¶éªŒè¯ï¼Œç›´æ¥æ ‡è®°ä¸ºå·²éªŒè¯
const user = { 
  ...
  emailVerified: true,  // ç›´æ¥è®¾ä¸º true
  // ä¸å‘é€éªŒè¯é‚®ä»¶
}

// è‡ªåŠ¨ç™»å½•
const token = await signJwt(...)
await setAuthCookie(token)

return NextResponse.json({ user, needsVerification: false })
```

**âš ï¸ è­¦å‘Š**: è¿™æ ·åšä¼šå¤±å»é‚®ç®±éªŒè¯çš„å®‰å…¨æ€§ï¼Œä»…é€‚åˆå¼€å‘æµ‹è¯•ï¼

---

## é€‰æ‹©ä½ çš„æ–¹æ¡ˆ

**å‘Šè¯‰æˆ‘ä½ æƒ³ç”¨å“ªä¸ªæ–¹æ¡ˆï¼Œæˆ‘ç«‹å³å¸®ä½ é›†æˆï¼**

1. Gmail SMTPï¼ˆ5 åˆ†é’Ÿï¼Œæœ€ç®€å•ï¼‰
2. Brevoï¼ˆ15 åˆ†é’Ÿï¼Œæ¨èé•¿æœŸä½¿ç”¨ï¼‰
3. æš‚æ—¶ç¦ç”¨é‚®ä»¶éªŒè¯ï¼ˆä»…æµ‹è¯•ç”¨ï¼‰

æˆ‘ä¼šç«‹å³å¸®ä½ å®Œæˆé›†æˆä»£ç ï¼ğŸš€

