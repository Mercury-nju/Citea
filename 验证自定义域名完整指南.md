# 🌐 Brevo 验证自定义域名完整指南

## 🎯 目标

- ✅ 使用专业邮箱：`noreply@yourdomain.com`
- ✅ 提高邮件送达率
- ✅ 消除"未验证"警告
- ✅ 提升用户信任度

---

## 📋 前提条件

1. ✅ 拥有一个域名（例如：`citea.com`、`mycitea.com` 等）
2. ✅ 可以访问域名的 DNS 管理（域名注册商或 DNS 服务商）

---

## 🚀 详细步骤

### 步骤 1: 在 Brevo 中添加域名

1. **访问 Brevo Dashboard**
   ```
   https://app.brevo.com/settings/senders
   ```

2. **切换到 "Domains" 标签**
   - 在 "Senders, Domains & Dedicated IPs" 页面
   - 点击顶部的 **"Domains"** 标签

3. **添加域名**
   - 点击 **"Add a domain"** 按钮
   - 输入你的域名（例如：`citea.com`）
   - **不要包含** `www` 或 `http://`
   - 点击 **"Add"** 或 **"Continue"**

---

### 步骤 2: 配置 DNS 记录

Brevo 会显示需要添加的 DNS 记录。通常需要添加以下记录：

#### 记录 1: SPF 记录

```
类型: TXT
名称: @ (或根域名，有些 DNS 提供商用空或域名本身)
值: v=spf1 include:spf.brevo.com ~all
TTL: 3600 (或默认)
```

**说明**：
- SPF 记录告诉收件服务器允许 Brevo 代表你的域名发送邮件
- `~all` 表示其他服务器发送的邮件会被标记为可疑

#### 记录 2: DKIM 记录

```
类型: TXT
名称: brevo._domainkey (或 Brevo 提供的完整名称)
值: (Brevo 会提供，类似: v=DKIM1; k=rsa; p=...)
TTL: 3600
```

**说明**：
- DKIM 用于邮件签名验证
- Brevo 会提供**唯一的 DKIM 值**，必须使用 Brevo 提供的值
- 名称可能不同，使用 Brevo 显示的确切名称

#### 记录 3: DMARC 记录（可选但推荐）

```
类型: TXT
名称: _dmarc
值: v=DMARC1; p=none; rua=mailto:your-email@yourdomain.com
TTL: 3600
```

**说明**：
- DMARC 提供邮件认证报告
- `p=none` 表示不拒绝未认证的邮件（初始阶段推荐）
- `rua` 是报告接收邮箱

---

### 步骤 3: 添加 DNS 记录到你的域名

#### 在哪里添加 DNS 记录？

**常见域名注册商**：
- **阿里云**：控制台 → 域名 → 解析设置
- **腾讯云**：控制台 → 域名注册 → 解析
- **Godaddy**：My Products → DNS
- **Namecheap**：Domain List → Advanced DNS
- **Cloudflare**：Dashboard → DNS → Records

#### 添加步骤（以 Cloudflare 为例）：

1. 登录 Cloudflare Dashboard
2. 选择你的域名
3. 进入 **DNS** 或 **解析** 设置
4. 点击 **"Add record"** 或 **"添加记录"**
5. 按照 Brevo 提供的信息添加：
   - 选择记录类型（TXT）
   - 输入名称（@ 或 Brevo 提供的名称）
   - 输入值（Brevo 提供的值）
   - 保存

#### 重复添加所有记录：
- ✅ SPF 记录
- ✅ DKIM 记录
- ✅ DMARC 记录（可选）

---

### 步骤 4: 在 Brevo 验证域名

1. **回到 Brevo Dashboard**
   - 进入 **Senders, Domains & Dedicated IPs** → **Domains**

2. **等待 DNS 传播**
   - DNS 记录可能需要几分钟到几小时生效
   - 通常 10-30 分钟就可以验证

3. **点击 "Verify domain"**
   - 在域名列表中，找到你添加的域名
   - 点击 **"Verify"** 或 **"Verify domain"** 按钮
   - Brevo 会检查 DNS 记录

4. **验证状态**
   - ✅ **Verified** - 域名验证成功
   - ⚠️ **Pending** - 等待 DNS 传播
   - ❌ **Failed** - 检查 DNS 记录是否正确

---

### 步骤 5: 添加发件邮箱

域名验证成功后：

1. **切换到 "Senders" 标签**

2. **添加发件人**
   - 点击 **"Add sender"**
   - 输入邮箱：`noreply@yourdomain.com`（使用你的域名）
   - 输入名称：`Citea`
   - 保存

3. **验证状态**
   - 由于域名已验证，邮箱会自动验证
   - 状态显示 **"Verified"** ✅

---

### 步骤 6: 更新 Vercel 环境变量

1. **访问 Vercel Dashboard**
   ```
   https://vercel.com/dashboard
   ```

2. **进入环境变量设置**
   - Settings → Environment Variables

3. **更新 BREVO_FROM_EMAIL**
   ```
   变量名: BREVO_FROM_EMAIL
   变量值: noreply@yourdomain.com (你的域名)
   环境: ✅ Production  ✅ Preview  ✅ Development
   ```

4. **保存并等待重新部署**

---

## 🔍 验证 DNS 记录是否生效

添加 DNS 记录后，可以使用以下工具验证：

### 在线工具：

1. **MXToolbox**: https://mxtoolbox.com/spf.aspx
   - 输入你的域名
   - 检查 SPF、DKIM、DMARC 记录

2. **DNS Checker**: https://dnschecker.org/
   - 输入记录类型和域名
   - 查看全球 DNS 传播状态

### 命令行验证：

```bash
# Windows PowerShell
nslookup -type=TXT yourdomain.com

# 或使用 dig（如果已安装）
dig TXT yourdomain.com
dig TXT brevo._domainkey.yourdomain.com
dig TXT _dmarc.yourdomain.com
```

---

## ✅ 验证成功后的效果

### 之前（使用 Gmail）：
- ❌ 发件人：`Citea <lihongyangnju@10039486.brevosend.com>`
- ❌ 警告："此地址未验证"
- ⚠️ 用户可能不信任

### 之后（使用验证域名）：
- ✅ 发件人：`Citea <noreply@citea.com>`
- ✅ 无警告提示
- ✅ 专业、可信
- ✅ 提高送达率

---

## 🐛 常见问题排查

### 问题 1: DNS 记录添加后验证失败

**排查**：
1. 检查记录类型是否正确（TXT）
2. 检查名称是否完全匹配（注意大小写和点）
3. 检查值是否完全复制（包括所有引号）
4. 等待 30 分钟后再试（DNS 传播需要时间）

**解决**：
- 使用在线工具验证 DNS 记录是否存在
- 确认值完全匹配 Brevo 提供的值

### 问题 2: DKIM 记录名称不匹配

**注意**：
- DKIM 记录的名称可能因 DNS 提供商而异
- 使用 Brevo 提供的**确切名称**
- 某些 DNS 需要添加点（`.`）或完整域名

### 问题 3: 验证一直显示 Pending

**可能原因**：
- DNS 还未完全传播
- 记录配置错误

**解决**：
- 使用在线工具检查 DNS 记录
- 等待更长时间（最多 48 小时）
- 重新检查记录配置

---

## 📝 快速检查清单

完成以下步骤后，域名验证就完成了：

- [ ] 在 Brevo 添加域名
- [ ] 添加 SPF 记录（TXT）
- [ ] 添加 DKIM 记录（TXT，使用 Brevo 提供的值）
- [ ] 添加 DMARC 记录（TXT，可选）
- [ ] 等待 DNS 传播（10-30 分钟）
- [ ] 在 Brevo 点击验证
- [ ] 域名状态显示 "Verified" ✅
- [ ] 添加发件人：`noreply@yourdomain.com`
- [ ] 更新 Vercel 环境变量
- [ ] 重新部署并测试

---

## 🎯 需要的信息

开始之前，请告诉我：

1. **你的域名是什么？**
   - 例如：`citea.com`、`mycitea.com`

2. **域名在哪里管理？**
   - 阿里云、腾讯云、Godaddy、Cloudflare 等

3. **是否需要我帮你生成 DNS 记录值？**
   - 我可以根据你的域名提供具体的配置

---

**告诉我你的域名，我可以提供更具体的配置步骤！** 🚀

